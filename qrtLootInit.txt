scn tryLootScript
;用于执行loot操作

Begin GameMode
	ref tryLootHelper
	set tryLootHelper to player
	ref rActor
	set rActor to GetFirstRef 24;Armor
	while rActor != 0
		ref owner
		set owner to rActor.GetOwner
		ref cellOwner
		set cellOwner to rActor.GetParentCellOwner
		if owner == player.GetBaseObject || owner == PlayerFaction || cellOwner == player.GetBaseObject || cellOwner == PlayerFaction
			int tempCount
			set tempCount to rActor.GetRefCount
			messageex "31 count=%g" tempCount
			rActor.activate tryLootHelper
			let tempCount -= 1
			ref base
			set base to rActor.GetBaseObject
			tryLootHelper.addItem base tempCount 1
			;rActor.SetRefCount tempCount
			;set tempCount to rActor.GetRefCount
			;messageex "31 count=%g" tempCount
			;messageex "owner= %n, cellOwner=%n" owner, cellOwner
			messageex "%n looted" rActor
		endif
		set rActor to GetNextRef
	loop
	set rActor to GetFirstRef 31;Misc
	while rActor != 0
		ref owner
		set owner to rActor.GetOwner
		ref cellOwner
		set cellOwner to rActor.GetParentCellOwner
		if owner == player.GetBaseObject || owner == PlayerFaction || cellOwner == player.GetBaseObject || cellOwner == PlayerFaction
			int tempCount
			set tempCount to rActor.GetRefCount
			messageex "31 count=%g" tempCount
			rActor.activate tryLootHelper
			let tempCount -= 1
			ref base
			set base to rActor.GetBaseObject
			tryLootHelper.addItem base tempCount 1
			;rActor.SetRefCount tempCount
			;set tempCount to rActor.GetRefCount
			;messageex "31 count=%g" tempCount
			;messageex "owner= %n, cellOwner=%n" owner, cellOwner
			messageex "%n looted" rActor
		endif
		set rActor to GetNextRef
	loop
	set rActor to GetFirstRef 40;Weapon
	while rActor != 0
		ref owner
		set owner to rActor.GetOwner
		ref cellOwner
		set cellOwner to rActor.GetParentCellOwner
		if owner == player.GetBaseObject || owner == PlayerFaction || cellOwner == player.GetBaseObject || cellOwner == PlayerFaction
			int tempCount
			set tempCount to rActor.GetRefCount
			messageex "31 count=%g" tempCount
			rActor.activate tryLootHelper
			let tempCount -= 1
			ref base
			set base to rActor.GetBaseObject
			tryLootHelper.addItem base tempCount 1
			;rActor.SetRefCount tempCount
			;set tempCount to rActor.GetRefCount
			;messageex "31 count=%g" tempCount
			;messageex "owner= %n, cellOwner=%n" owner, cellOwner
			messageex "%n looted" rActor
		endif
		set rActor to GetNextRef
	loop
	set rActor to GetFirstRef 41;Ammo
	while rActor != 0
		ref owner
		set owner to rActor.GetOwner
		ref cellOwner
		set cellOwner to rActor.GetParentCellOwner
		if owner == player.GetBaseObject || owner == PlayerFaction || cellOwner == player.GetBaseObject || cellOwner == PlayerFaction
			int tempCount
			set tempCount to rActor.GetRefCount
			messageex "31 count=%g" tempCount
			rActor.activate tryLootHelper
			let tempCount -= 1
			ref base
			set base to rActor.GetBaseObject
			tryLootHelper.addItem base tempCount 1
			;rActor.SetRefCount tempCount
			;set tempCount to rActor.GetRefCount
			;messageex "31 count=%g" tempCount
			;messageex "owner= %n, cellOwner=%n" owner, cellOwner
			messageex "%n looted" rActor
		endif
		set rActor to GetNextRef
	loop
	set rActor to GetFirstRef 46;Key
	while rActor != 0
		ref owner
		set owner to rActor.GetOwner
		ref cellOwner
		set cellOwner to rActor.GetParentCellOwner
		if owner == player.GetBaseObject || owner == PlayerFaction || cellOwner == player.GetBaseObject || cellOwner == PlayerFaction
			int tempCount
			set tempCount to rActor.GetRefCount
			messageex "31 count=%g" tempCount
			rActor.activate tryLootHelper
			let tempCount -= 1
			ref base
			set base to rActor.GetBaseObject
			tryLootHelper.addItem base tempCount 1
			;rActor.SetRefCount tempCount
			;set tempCount to rActor.GetRefCount
			;messageex "31 count=%g" tempCount
			;messageex "owner= %n, cellOwner=%n" owner, cellOwner
			messageex "%n looted" rActor
		endif
		set rActor to GetNextRef
	loop
	set rActor to GetFirstRef 47;AlchemyItem
	while rActor != 0
		ref owner
		set owner to rActor.GetOwner
		ref cellOwner
		set cellOwner to rActor.GetParentCellOwner
		if owner == player.GetBaseObject || owner == PlayerFaction || cellOwner == player.GetBaseObject || cellOwner == PlayerFaction
			int tempCount
			set tempCount to rActor.GetRefCount
			messageex "31 count=%g" tempCount
			rActor.activate tryLootHelper
			let tempCount -= 1
			ref base
			set base to rActor.GetBaseObject
			tryLootHelper.addItem base tempCount 1
			;rActor.SetRefCount tempCount
			;set tempCount to rActor.GetRefCount
			;messageex "31 count=%g" tempCount
			;messageex "owner= %n, cellOwner=%n" owner, cellOwner
			messageex "%n looted" rActor
		endif
		set rActor to GetNextRef
	loop
	set rActor to GetFirstRef 49;Note
	while rActor != 0
		ref owner
		set owner to rActor.GetOwner
		ref cellOwner
		set cellOwner to rActor.GetParentCellOwner
		if owner == player.GetBaseObject || owner == PlayerFaction || cellOwner == player.GetBaseObject || cellOwner == PlayerFaction
			int tempCount
			set tempCount to rActor.GetRefCount
			messageex "31 count=%g" tempCount
			rActor.activate tryLootHelper
			let tempCount -= 1
			ref base
			set base to rActor.GetBaseObject
			tryLootHelper.addItem base tempCount 1
			;rActor.SetRefCount tempCount
			;set tempCount to rActor.GetRefCount
			;messageex "31 count=%g" tempCount
			;messageex "owner= %n, cellOwner=%n" owner, cellOwner
			messageex "%n looted" rActor
		endif
		set rActor to GetNextRef
	loop
End